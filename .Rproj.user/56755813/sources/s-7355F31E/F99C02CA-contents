library(tidyverse)
library(lubridate)
library(DBI)
library(RPostgreSQL)
library(igraph)
library(tidygraph)
library(stringdist)
library(ggraph)

drv <- dbDriver("PostgreSQL")

con <- dbConnect(drv, dbname = "mjcs",
                 user = "mjcs_ro",
                 password = rstudioapi::askForPassword("password"),
                 port = 5432,
                 host = "mjcs.c7q0zmxhx4uo.us-east-1.rds.amazonaws.com")

cops <- dbGetQuery(con, statement = "
           SELECT 
             cases.case_number, 
             case_type, 
             filing_date, 
             name, 
             connection, 
             officer_id,
             COALESCE(name, officer_id) AS name2
           FROM cases
           INNER JOIN dscr_related_persons AS people
           ON cases.case_number = people.case_number
           WHERE filing_date >= '2017-01-01'
           AND connection ILIKE '%POLICE OFFICER%';
           ")